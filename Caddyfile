# Reeder Caddyfile
# Serves audio files and RSS feed over HTTP

:80 {
    root * /var/lib/reeder/www

    # Audio files with directory browsing
    @audio path /audio/*
    handle @audio {
        file_server browse
    }

    # Redirect /audio to /audio/
    handle /audio {
        redir /audio/ permanent
    }

    # RSS feed
    @feed path /feed.xml
    handle @feed {
        header Content-Type application/rss+xml
        file_server
    }

    # Everything else proxies to reeder-web
    handle {
        reverse_proxy localhost:8081
    }

    # MIME types
    @opus path *.opus
    header @opus Content-Type audio/opus

    # Compression
    encode gzip

    # Logging
    log {
        output file /var/log/caddy/reeder.log
    }
}
